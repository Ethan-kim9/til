# JPA

# 도메인과 엔티티를 나눠야 하는 이유?
1. 관심사의 분리 
   - 엔티티와 DTO를 분리해야 하는 가장 근본적인 이유는 관심사가 서로 다르기 때문이다. 
   - 관심사의 분리(separation of concerns, SoC)는 소프트웨어 분야의 오래된 원칙 중 하나로써, 서로 다른 관심사들을 분리하여 변경 가능성을 최소화하고, 유연하며 확장가능한 클린 아키텍처를 구축하도록 도와준다. 
     1. DTO(Data Transfer Object)의 핵심 관심사는 이름 그대로 데이터의 전달 
        1. DTO는 데이터를 담고, 다른 계층(Layer) 또는 다른 컴포넌트들로 데이터를 넘겨주기 위한 자료구조(Data Structure) 즉, `어떠한 기능 및 동작도 없어야 함` 
     2. 엔티티(Entity) 는 핵심 비지니스 로직을 담는 비지니스 도메인의 영역의 일부 
        1. 그러므로 엔티티 또는 도메인 객체는 그에 따른 비지니스 로직이 추가될 수 있음. 
     3. 엔티티 또는 도메인 객체는 다른 계층이나 컴포넌트들 사이에서 전달을 위해 사용되는 객체가 아님.
   즉 엔티티와 DTO 는 엄연히 서로 다른 관심사를 가지고 있고, 그렇기 때문에 분리하는 것이 합리적
   
2. Validation 로직 및 불필요한 코드 등과의 분리 
   - Spring 에서는 요청에 대한 데이터를 검증하기 위해 @Valid 어노테이션을 지원
   - @Valid 처리를 위해서는 @NotNull, @NotEmpty, @Size 등과 같은 유효성 검증 어노테이션들을 변수에 붙여주어야 한다. 
   - JPA 도 변수에 @Id, @Column 등과 같은 어노테이션들을 활용해 객체와 관계형 데이터베이스를 매핑해 
   - DTO 와 엔티티를 분리하지 않는다면 엔티티의 코드가 상당히 복잡해짐
     - 유지보수에 단점이 생김

3. API 스펙과의 분리 
   - 내부 정책의 변경으로 API 의 값을 변경할 때, DTO 가 없으면 항상 API 스펙을 모두 변경하게 되고 사용자들은 장애를 겪게됨
     - DTO 를 이용, 독립성을 높여 변경의 전파를 막아야함
     - ResponseDTO 생성을 통해서 안정성 확보가 가능하다.
     
4. API 스펙의 파악이 용이
   - 해당 스펙을 완벽히 파악하는 것은 불가능하겠지만, 꽤나 많은 API 스펙들을 얻을 수 있다. 
   - ex) email 의 값은 email 포맷이어야 하고, pw 는 비어있어서는 안되는 등을 파악할 수 있다.
     즉 DTO 를 작성함으로써 어느 정도 API 문서의 요약본을 작성하는 것과 유사한 효과를 얻을 수 있다.
   - 특히 요즘 같은 MSA 아키텍처로 개발을 많이 하는 상황에서 다른 사람이 작성한 API 호출 코드를 파악할 때 요청/응답을 손쉽게 파악할 수 있어 용이하다.


출처: https://mangkyu.tistory.com/192 [MangKyu's Diary]

## 도메인 모델과 엔티티 모델의 분리할 때 주안점

- 엔티티 모델은 JPA 의 어노테이션들이 붙여야만 함
- 도메인 모델은 가능한 모든 기술로부터 독립되는 것이 이상적 
  - 엔티티모델에서 to도메인모델() 같은 메소드를 통해 변환메소드 제공 
- 엔티티 모델을 그대로 사용할 경우, 컨트롤러, 뷰 레이어까지 트랜잭션이나 지연로딩 등을 활용할 순 있으나, 권장하진 않음.
  1) OSIV(Open Session In View)을 false로 설정하자 
  2) DTO 로 분리


